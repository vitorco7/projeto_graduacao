#Edit the file here, then copy it with root permissions to /etc/telegraf/telegraf.conf
#Example 
#sudo cp ./hosts-monitoring/ubuntu20_work-host/telegraf.conf /etc/telegraf/telegraf.conf

#Enable telegraf to start on boot -> sudo systemctl enable telegraf
#verify if it's enabled -> sudo systemctl is-enabled telegraf

#IMPORTANT -> REMEMBER TO ALLOW TELEGRAF PORT THROUGH FIREWALL!!!

#starting telegraf - sudo systemctl start telegraf

#verify telegraf status - sudo systemctl status telegraf

#test telegraf => sudo telegraf --config /etc/telegraf/telegraf.conf --test

#restarting telegraf - sudo systemctl restart telegraf

#Run this after every update on this file:
#sudo cp ./hosts-monitoring/ubuntu20_work-host/telegraf.conf /etc/telegraf/telegraf.conf && sudo systemctl restart telegraf


# Global Agent Configuration
[agent]
  interval = "30s"
  round_interval = true
  metric_batch_size = 500  # Reduced from 1000
  metric_buffer_limit = 5000  # Reduced from 10000
  collection_jitter = "5s"  # Added jitter
  flush_interval = "30s"
  flush_jitter = "5s"  # Added jitter
  precision = ""
  debug = true  # Enable debug logging
  quiet = false
  logtarget = "stderr"
  hostname = ""
  omit_hostname = false

# Prometheus-compatible output with retry logic
[[outputs.prometheus_client]]
  listen = ":9273"
  path = "/metrics"
  expiration_interval = "120s"  # Increased from 60s
  metric_version = 2


# ####CPU Metrics####
# [[inputs.cpu]]
#     name_override = "physical_cpu"
#     fieldexclude = ["usage_guest", "usage_guest_nice", "usage_steal", ]

# ####Memory Metrics####
# [[inputs.mem]]
#     name_override = "physical_mem"
#     fieldinclude = ["used_percent", "available", "available_percent", "used", "swap_total", "swap_free", "swap_cached", "total"]
#     # fieldexclude = ["dirty", "write_back", "slab", "sreclaimable",  "sunreclaim", "page_tables", "mapped", "huge_page_size", "huge_page_free", "huge_page_total", "vmalloc_chunk", "vmalloc_total", "vmalloc_used", "write_back", "write_back_tmp"]

# ###Disk Metrics####
# [[inputs.disk]]
#   name_override = "physical_disk"
#   fieldinclude = ["free", "used", "total", "used_percent", "inodes_free", "inodes_used", "inodes_total", "inodes_used_percent"]

# [[inputs.diskio]]
#   name_override = "physical_disk_i/o"
#   fieldexclude = ["iops_in_progress", "weighted_io_time", "merged_reads", "merged_writes"]


# CONTINUAR DAQUI PRA BAIXO

# ####Network Metrics####
# [[inputs.net]]
#   name_override = "physical_net"

# [[inputs.netstat]]
#   name_override = "physical_net_stat"

# ####Processes Metrics####
# [[inputs.processes]] #System-wide process statistics
#   name_override = "physical_processes"

# [[inputs.procstat]] #Per-process detailed metrics
#   name_override = "physical_proc_stat"
