FROM alpine

ENV NODE_EXPORTER_VERSION=1.9.0

RUN apk add --no-cache wget stress-ng tar

RUN wget https://github.com/prometheus/node_exporter/releases/download/v$NODE_EXPORTER_VERSION/node_exporter-$NODE_EXPORTER_VERSION.linux-amd64.tar.gz

RUN tar -xzf node_exporter-$NODE_EXPORTER_VERSION.linux-amd64.tar.gz

RUN mv node_exporter-$NODE_EXPORTER_VERSION.linux-amd64/node_exporter /usr/local/bin/

RUN rm -rf node_exporter-$NODE_EXPORTER_VERSION.linux-amd64*

COPY user-load-simulator-alpine.sh /usr/local/bin/user-load-simulator-alpine.sh

RUN chmod +x /usr/local/bin/user-load-simulator-alpine.sh

WORKDIR /

# Modified command to isolate container metrics
# We're explicitly setting which collectors to use and specifying the paths
# This ensures node_exporter only collects container metrics, not host metrics
CMD ["/bin/sh", "-c", "nohup /usr/local/bin/user-load-simulator-alpine.sh & /usr/local/bin/node_exporter --collector.disable-defaults --collector.cpu --collector.meminfo --collector.loadavg --collector.filesystem --collector.netdev --path.procfs=/proc --path.sysfs=/sys"]